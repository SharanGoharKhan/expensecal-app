var app = angular.module('App',['ui.router','restangular','ngCookies','ngSanitize','angular-momentjs', 'ngFileUpload','LocalStorageModule','oc.lazyLoad']);



app.run(["$rootScope", "$location", "$state", "$moment", "localStorageService", function($rootScope, $location, $state,$moment,localStorageService){
	var env = $location.host().split('.').pop();
	var protocol = "http";
	$rootScope.app = {
		"name" : "Expensecal",
		"apiUrl" : protocol + "://api.expensecal." + env,
		"appUrl" : protocol + "://app.expensecal." + env,
		"env" : env
	};
	$rootScope.user=localStorageService.get("$user");
}]);

var app = angular.module("App");

app.directive('navBarMenu', [function() {
	return {
		restrict: 'A',
		scope: false,
		link: function(scope, element, attrs) {
			$('.ui.menu .ui.dropdown').dropdown({
        	on: 'hover'
      		});
      		$('.ui.menu a.item')
        	.on('click', function() {
          	$(this)
            .addClass('active')
            .siblings()
            .removeClass('active');
        });
		}
	};
}]);
var app = angular.module("App");

app.directive('navBarDropbox',[function(){
	return {
		restrict: 'A',
		scope: false,
		link: function(scope,element,attrs){
			$('.ui.dropdown').dropdown();
	      			$('.ui.buttons .dropdown.button').dropdown
	      			({
	        			action: 'combo'
	      			});
		}
	};
}]);
var app = angular.module("App");

app.directive('imTextFader', [function() {
	return {
		restrict: 'A',
		scope: false,
		link: function(scope, element, attrs) {
			// $('.ui.menu .ui.dropdown').dropdown({
   //      	on: 'hover'
   //    		});
   //    		$('.ui.menu a.item')
   //      	.on('click', function() {
   //        	$(this)
   //          .addClass('active')
   //          .siblings()
   //          .removeClass('active');
   // for(var f=0;f<100;f++)
   // {
        //while(true)
        //{
          // for(var i=0;i<element.children.length;++i)
          // {
          //   $(element[0].children[i]).fadeIn(1000);
          //   $(element[0].children[i]).fadeOut(1000);

          // }
        //}  
        
   // }
        // console.log(element[0].children[0])
        // console.log("imTextFader called");

        //});
        var children=$(element[0].children);
        for(var i=0;i<children.length;i++)
        {
          $(children[i]).fadeIn("slow");
          //setTimeout(function(){ console.log("Time out") }, 30000);
        }
		}
	};
}]);
app.directive('imSignout', ['localStorageService','$state','$rootScope',function (localStorageService,$state,$rootScope) {
	return {
		restrict: 'A',
		link: function (scope, iElement, iAttrs) {
			console.log("signout caled");
			localStorageService.remove('$user');
			$rootScope.user = null;
			scope.user = null;
			// scope.$apply();	
			//TODO delete access_token
			$state.go("app.public.join");
		}
	};
}])

var app = angular.module("App");

app.directive('headerHamburgerMenu', ['$rootScope', function($rootScope) {
	return {
		restrict: 'E',
		scope: false,
		templateUrl: '/templates/core/ang/templates/headerHamburgerMenu.html',
		link: function(scope, element, attrs) {
			scope.onClick = function() {
  				$('button', element).toggleClass('expanded').siblings('div').slideToggle();
			};

			scope.onClick = function() {
				$('button', element).toggleClass('expanded').siblings('div').slideToggle();
			};
		}
	};
}]);
var app = angular.module("App");

app.directive('navBarDropbox',[function(){
	return {
		restrict: 'A',
		scope: false,
		link: function(scope,element,attrs){
			$('.special.card .image').dimmer({
        	on: 'hover'
      		});
      		$('.star.rating')
        	.rating();
      		$('.card .dimmer')
        	.dimmer({
          	on: 'hover'
        	});
		}
	};
}]);
var app = angular.module('App');
app.controller('AppController', ["$scope", "$rootScope", "localStorageService", "$state", function ($scope,$rootScope,localStorageService,$state) {
}]);

var app = angular.module('App');
app.config(["$stateProvider", "$urlRouterProvider", "$locationProvider", function($stateProvider,$urlRouterProvider, $locationProvider){
	
	$locationProvider.html5Mode({ enabled: true, requireBase: true });
    $stateProvider
        .state('app',{
            abstract: true,
            controller: 'AppController',
            template: '<ui-view></ui-view>'
        });
    $urlRouterProvider.otherwise('/home');    	
}]);
app.controller('AppController',["$scope", "$rootScope", function($scope, $rootScope){

    $rootScope.$on('$locationChangeSuccess', function(e) {
        /* To set the page scroll Top to 0, to show the start of page. */
        window.scrollTo(0,0);
    });
}]);

var app = angular.module('App');

app.config(["RestangularProvider", function(RestangularProvider){
	RestangularProvider.setRestangularFields({
	  id: "_id"
	});
}]);

app.run(["$rootScope", "$http", "Restangular", "$location", function($rootScope, $http, Restangular,$location){
	var env = $location.host().split('.').pop();
	var protocol = (env == 'com') ? "https" : "http";
	$rootScope.app = {
  	    "name" : "ExpenseCal",
  	    "apiUrl": protocol +"://api.expensecal." + env,
        "appUrl": protocol +"://app.expesecal." + env,
        "env": env
  	};
    Restangular.setBaseUrl($rootScope.app.apiUrl);
    Restangular.setDefaultHeaders({'Content-Type': 'application/json'});

    $http.defaults.useXDomain = true;
}]);
var app = angular.module ('App');

app.config(["$httpProvider", function($httpProvider){
	$httpProvider.interceptors.push('httpInterceptor');
}]);

app.factory('httpInterceptor', ["$q", "$rootScope", "$injector", "$location", function ($q, $rootScope, $injector, $location) {
    return {
        'request': function (config) {
            return config || $q.when(config);
        },
        'response': function(response) {        	
            return response;
        },
        'requestError': function (rejection) {
            return $q.reject(rejection);
        },
        'responseError': function (rejection) {
            return $q.reject(rejection);           
        }
    };
}]);
var app = angular.module('App');

app.config(["$stateProvider", function($stateProvider){
	$stateProvider
		.state("app.public.signup",{
			url: '/signup',
			templateUrl: "/templates/components/public/signup/signup.html",
			controller: "SignupController"
		})
}]); 
app.controller("SignupController", ["$scope", "$http", "localStorageService", "$rootScope", "Restangular", "$state", function ($scope,$http,localStorageService,$rootScope,Restangular,$state) {
	$scope.register = function()
	{
		$http.post($scope.app.apiUrl+"/auth/register",$scope.user)
			.then(function successCallback(response){
				$rootScope.$user=response.data;
				localStorageService.set('$user',$rootScope.$user);
			},function errorCallback(response)
			{
				console.log(response);
			});
	}
}]);
var app = angular.module('App');

app.config(["$stateProvider", function($stateProvider){
	$stateProvider
		.state("app.public.signin",{
			url: "/signin",
			templateUrl: "/templates/components/public/signin/signin.html",
			controller: "SigninController"
		})
}]); 

app.controller("SigninController", ["$scope", "$http", "localStorageService", "$rootScope", "Restangular", "$state", function ($scope,$http,localStorageService,$rootScope,Restangular,$state) {
	$scope.message= "signin controller";
	$scope.login=function(type)
	{		
		$http.post($scope.app.apiUrl+"/auth/login",$scope.user)
			.then(function statusChangeCallback(response){
				$rootScope.$user=response.data;
				localStorageService.set('$user',$rootScope.$user);
				$state.go('app.public.home');
			},function errorCallback(response)
			{
				
			});
		
	}
}]);
var app = angular.module('App');

app.config(["$stateProvider", function($stateProvider){
	$stateProvider
		.state("app.public.home",{
			url: "/home",
			templateUrl: "/templates/components/public/home/home.html",
			controller: "HomeController"
		})
}]); 

app.controller("HomeController", ["$scope", "$rootScope", function ($scope,$rootScope) {
	$scope.message = "home controller";
}]);
var app = angular.module('App');

app.config(["$stateProvider", function($stateProvider){
	$stateProvider
		.state("app.public.expense",{
			url: '/expense',
			templateUrl: "/templates/components/public/expense/expense.html",
			controller: "ExpenseController"
		})
}]); 
app.controller("ExpenseController", ["$scope", function ($scope) {
	$scope.message = "Expense Controller";
}]);
var app = angular.module("App");

app.config(["$stateProvider", function($stateProvider){
	$stateProvider
		.state("app.public.category",{
			url: "/category",
			templateUrl: "/templates/components/public/category/category.html",
			controller: "CategoryController"
		})
}]); 

app.controller("CategoryController", ["$scope", "$rootScope", function ($scope, $rootScope) {
	$scope.message="Category controller";
}]);
var app = angular.module('App');

app.config(["$stateProvider", function($stateProvider){
	$stateProvider
		.state("app.public",{
			abstract: true,
			templateUrl: "/templates/components/public/public.html",
			controller: "PublicController"
		})
}]); 
app.controller("PublicController", ["$scope", "$rootScope", "localStorageService", "$state", function ($scope,$rootScope,localStorageService,$state) {
	$rootScope.user=localStorageService.get("$user");
	$scope.user=$rootScope.user;
	if($scope.user)
	{
		console.log("user is not empty");
	}
	else
		console.log("user is empty");
	console.log("Before signout: "+$scope.user);
	$scope.signout = function()
	{
		console.log("After signout: "+$scope.user);
		localStorageService.remove('$user');
		$rootScope.user = null;
		$scope.user = null;
		$scope.$apply();
		$state.go("app.public.signin");
	}
}]);
